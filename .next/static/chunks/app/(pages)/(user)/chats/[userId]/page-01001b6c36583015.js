(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{26037:(e,a,i)=>{Promise.resolve().then(i.bind(i,25040))},25040:(e,a,i)=>{"use strict";i.r(a),i.d(a,{default:()=>E});var t=i(95155),r=i(12115),l=i(76046),s=i(83391),o=i(71319),n=i(68998),d=i(78562),u=i(10979),c=i(894),m=i(30562),p=i(9561),g=i(8707),h=i(36056),f=i(78416),y=i(36417),v=i(27753),x=i(75131),D=i(26214),w=i(22282),S=i(12111),j=i(280),b=i(11441),A=i(67396),I=i(76581),_=i(7515),k=i(7882),q=i(22293);function C(e){let{message:a,time:i,image:r}=e;return(0,t.jsxs)(u.default,{alignSelf:"flex-end",alignItems:"end",direction:"row",gap:1,children:[(0,t.jsxs)(n.A,{bgcolor:"#046af2",px:1,py:1,borderRadius:2,color:"white",display:"flex",flexDirection:"column",flexWrap:"wrap",children:[(0,t.jsx)(p.A,{noWrap:!1,sx:{whiteSpace:"normal",overflowWrap:"break-word",wordBreak:"break-word",fontSize:["0.6rem","1rem"]},children:a}),(0,t.jsx)(p.A,{alignSelf:"flex-end",sx:{fontSize:["0.6rem","0.7rem"],opacity:.7},children:i})]}),(0,t.jsx)(m.A,{src:r,sx:{height:["1rem","1.5rem"],width:["1rem","1.5rem"]}})]})}function U(e){let{message:a,time:i,image:r}=e;return(0,t.jsxs)(u.default,{alignSelf:"flex-start",alignItems:"end",direction:"row-reverse",gap:1,children:[(0,t.jsxs)(n.A,{bgcolor:"#06D001",px:1,py:1,borderRadius:2,color:"white",display:"flex",flexDirection:"column",children:[(0,t.jsx)(p.A,{noWrap:!1,sx:{whiteSpace:"normal",overflowWrap:"break-word",wordBreak:"break-word",fontSize:["0.6rem","1rem"]},children:a}),(0,t.jsx)(p.A,{alignSelf:"flex-end",sx:{fontSize:["0.6rem","0.7rem"],opacity:.7},children:i})]}),(0,t.jsx)(m.A,{src:r,sx:{height:["1rem","1.5rem"],width:["1rem","1.5rem"]}})]})}var N=i(19347),T=i(18244);let P=(0,o.Ay)("https://chat-along-external-server.onrender.com/");function E(){var e,a,i;let{allUsersData:o,userData:E}=(0,s.d4)(e=>e.User),M=(0,s.wA)(),O=(0,l.useParams)(),z=(0,l.useRouter)(),[L,B]=(0,r.useState)(""),[R,W]=(0,r.useState)(null),[Y,J]=(0,r.useState)(!1),[Q,F]=(0,r.useState)(!1),V=(0,r.useRef)(null),[X]=(0,T.lJ)(),[G]=(0,T.qB)(),K=()=>{W(null)},Z=()=>{J(!0)},$=()=>{J(!1)},H=o.find(e=>e._id===O.userId);P.off().on("receiveTypingSignal",e=>{e.receiverId===(null==E?void 0:E._id)&&(F(!0),setTimeout(()=>{F(!1)},2e3))});let ee=()=>{let e={senderId:E._id||"",receiverId:(null==H?void 0:H._id)||"",isTyping:!0};P.off().emit("sendTypingSignal",e)},ea=async()=>{let e={senderId:E._id||"",receiverId:(null==H?void 0:H._id)||"",message:L,image:E.image||{image_url:"",public_id:""},time:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})};P.off().emit("sendMessage",e),M((0,N.cE)({receiverId:(null==H?void 0:H._id)||"",image:E.image||{image_url:"",public_id:""},message:L,time:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})})),B(""),await X({receiverId:e.receiverId,message:e.message,image:e.image,time:e.time})};return(0,t.jsxs)(n.A,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",py:1,children:[(0,t.jsx)(d.A,{elevation:0,children:(0,t.jsxs)(u.default,{paddingY:1,paddingX:1,direction:"row",alignItems:"center",justifyContent:"space-between",gap:2,width:"100%",children:[(0,t.jsxs)(u.default,{direction:"row",spacing:1,alignItems:"center",children:[(0,t.jsx)(A.default,{href:"/chats",children:(0,t.jsx)(c.A,{"area-label":"Open Notifications",size:"large",children:(0,t.jsx)(I.A,{sx:{fontSize:"1.5rem"}})})}),(0,t.jsx)(u.default,{sx:{cursor:"pointer"},direction:"row",gap:2,onClick:()=>{z.push("/".concat(null==H?void 0:H.username))},children:(0,t.jsxs)(u.default,{direction:"row",gap:[1,2],children:[(0,t.jsx)(m.A,{sx:{height:["2rem","3rem"],width:["2rem","3rem"]},src:null==H?void 0:null===(e=H.image)||void 0===e?void 0:e.image_url}),(0,t.jsxs)(u.default,{children:[(0,t.jsx)(p.A,{sx:{fontSize:["0.8rem","1rem"]},children:null==H?void 0:H.name}),(0,t.jsx)(p.A,{sx:{opacity:.7,fontSize:["0.8rem","1rem"]},children:null==H?void 0:H.username})]}),Q?(0,t.jsx)(p.A,{sx:{fontWeight:"bold"},variant:"caption",children:"Typing..."}):null]})})]}),(0,t.jsx)(c.A,{"area-label":"Open Notifications",size:"large",onClick:e=>{W(e.currentTarget)},children:(0,t.jsx)(_.A,{sx:{fontSize:"1.5rem"}})}),(0,t.jsx)(g.A,{id:"basic-menu",anchorEl:R,open:!!R,onClose:K,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,t.jsx)(h.A,{onClick:()=>{K(),Z()},sx:{"&:hover":{color:"error"}},children:"Clear Messages"})}),(0,t.jsxs)(f.A,{open:Y,onClose:$,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,t.jsx)(y.A,{id:"alert-dialog-title",children:"Delete post"}),(0,t.jsx)(v.A,{children:(0,t.jsx)(x.A,{id:"alert-dialog-description",children:"Are you sure you want to delete these messages?"})}),(0,t.jsxs)(D.A,{children:[(0,t.jsx)(w.default,{onClick:$,children:"Cancel"}),(0,t.jsx)(w.default,{onClick:()=>{M((0,N.mF)((null==H?void 0:H._id)||"")),G((null==H?void 0:H._id)||""),$()},color:"error",autoFocus:!0,children:"Yes"})]})]})]})}),(0,t.jsx)(n.A,{paddingX:0,marginBottom:1,height:"100%",width:"100%",sx:{overflowY:"auto"},display:"flex",flexDirection:"column-reverse",gap:1,children:null===(i=E.chats)||void 0===i?void 0:null===(a=i["".concat(null==H?void 0:H._id)||""])||void 0===a?void 0:a.slice().reverse().map((e,a)=>"sender"===e.name?(0,t.jsx)(C,{message:e.message,time:e.time,image:e.image.image_url},a):(0,t.jsx)(U,{message:e.message,time:e.time,image:e.image.image_url},a))}),(0,t.jsx)(S.A,{variant:"outlined",fullWidth:!0,color:"primary",children:(0,t.jsx)(j.A,{id:"outlined-adornment-message",type:"text",placeholder:"Message",sx:{borderRadius:"30px",fontSize:"0.8rem"},value:L,onChange:e=>{B(e.target.value)},onKeyUp:e=>{"Enter"===e.key?ea():ee()},endAdornment:(0,t.jsx)(b.A,{position:"end",children:""===L?(0,t.jsxs)(c.A,{"aria-label":"image",edge:"end",onClick:()=>{var e;null===(e=V.current)||void 0===e||e.click()},children:[(0,t.jsx)(k.A,{}),(0,t.jsx)("input",{style:{display:"none"},type:"file",ref:V})]}):(0,t.jsx)(c.A,{"aria-label":"message",color:"primary",edge:"end",onClick:()=>{ea()},children:(0,t.jsx)(q.A,{})})})})})]})}},18244:(e,a,i)=>{"use strict";i.d(a,{DQ:()=>t.DQ,IM:()=>t.IM,Iq:()=>t.Iq,Ll:()=>t.Ll,R3:()=>t.R3,VY:()=>t.VY,_L:()=>t._L,gx:()=>t.gx,lJ:()=>t.lJ,og:()=>t.og,oq:()=>t.oq,qB:()=>t.qB,rU:()=>t.rU});var t=i(34120)},34120:(e,a,i)=>{"use strict";i.d(a,{DQ:()=>o,IM:()=>u,Iq:()=>f,Ll:()=>s,R3:()=>p,VY:()=>x,_L:()=>n,dG:()=>l,gx:()=>D,lJ:()=>y,og:()=>g,oq:()=>d,qB:()=>v,rU:()=>c});var t=i(39295),r=i(30565);let l=(0,t.xP)({reducerPath:"usersApi",baseQuery:(0,r.cw)({baseUrl:"http://localhost:3000"}),endpoints:e=>({login:e.mutation({query:e=>({url:"api/login",method:"POST",body:{username:e.username,password:e.password}})}),checkEmailInDB:e.mutation({query:e=>({url:"api/check-email",method:"POST",body:{email:e}})}),checkUsernameInDB:e.mutation({query:e=>({url:"api/check-username",method:"POST",body:{firstName:e.firstName,phone:e.phone,username:e.username}})}),signup:e.mutation({query:e=>({url:"/api/signup",method:"POST",body:{email:e.email,password:e.password,name:e.name,image:e.image,username:e.username,phone:e.phone}})}),logout:e.mutation({query:()=>({url:"api/logout",method:"DELETE"})}),fetchUserData:e.query({query:()=>"api/get-user-profile"}),fetchAllUsersData:e.query({query:()=>"api/get-all-users"}),followUnfollowUser:e.mutation({query:e=>({url:"api/follow-unfollow-user",method:"PUT",body:{userId:e}})}),addStatus:e.mutation({query:e=>({url:"api/add-status",method:"POST",body:{statusContent:e.statusContent,colorCode:e.colorCode,colorName:e.colorName}})}),editProfile:e.mutation({query:e=>({url:"api/edit-user-profile",method:"PUT",body:{image:e.image,name:e.name,email:e.email,phone:e.phone}})}),deleteStatus:e.mutation({query:e=>({url:"api/delete-status",method:"DELETE",body:{statusId:e}})}),saveMessage:e.mutation({query:e=>({url:"api/save-message",method:"POST",body:{receiverId:e.receiverId,time:e.time,image:e.image,message:e.message}})}),clearMessages:e.mutation({query:e=>({url:"api/clear-messages",method:"POST",body:{receiverId:e}})}),saveNotification:e.mutation({query:e=>({url:"api/save-notification",method:"POST",body:{receiverId:e.receiverId,link:e.link,image:e.image,senderName:e.senderName,action:e.action}})}),clearNotifications:e.mutation({query:()=>({url:"api/clear-notifications",method:"PUT"})})})}),{useFetchUserDataQuery:s,useFetchAllUsersDataQuery:o,useLoginMutation:n,useCheckEmailInDBMutation:d,useCheckUsernameInDBMutation:u,useSignupMutation:c,useLogoutMutation:m,useFollowUnfollowUserMutation:p,useAddStatusMutation:g,useEditProfileMutation:h,useDeleteStatusMutation:f,useSaveMessageMutation:y,useClearMessagesMutation:v,useSaveNotificationMutation:x,useClearNotificationsMutation:D}=l},19347:(e,a,i)=>{"use strict";i.d(a,{$m:()=>n,Aj:()=>y,BJ:()=>u,Jx:()=>s,N1:()=>m,Sl:()=>p,Xn:()=>l,aP:()=>g,cE:()=>d,mF:()=>c,oN:()=>t,rM:()=>o,yQ:()=>h,zY:()=>r});let t=(0,i(72212).Z0)({name:"Users",initialState:{userData:{},allUsersData:[],loading:!0,isAuthenticated:!1,isDialogOpened:!1},reducers:{storeUserDataInState:(e,a)=>{e.userData=a.payload},storeAllUsersDataInState:(e,a)=>{e.allUsersData=a.payload},followUnfollowUserInState:(e,a)=>{var i,t,r,l,s,o,n;let d=null===(i=e.userData.following)||void 0===i?void 0:i.find(e=>e._id===a.payload._id),u=e.allUsersData.find(e=>e._id===a.payload._id);if(d){let i=null===(t=e.userData.following)||void 0===t?void 0:t.findIndex(e=>e._id===a.payload._id);null===(r=e.userData.following)||void 0===r||r.splice(Number(i),1);let o=null==u?void 0:null===(l=u.followers)||void 0===l?void 0:l.find(a=>a._id===e.userData._id);null==u||null===(s=u.followers)||void 0===s||s.splice(Number(o),1)}else null===(o=e.userData.following)||void 0===o||o.push({_id:a.payload._id,name:a.payload.name,image:a.payload.image,username:a.payload.username}),null==u||null===(n=u.followers)||void 0===n||n.push({_id:e.userData._id||"",name:e.userData.name||"",image:e.userData.image||{image_url:"",public_id:""},username:e.userData.username||""})},handleAuthentication:(e,a)=>{e.isAuthenticated=a.payload},handleDialog:(e,a)=>{e.isDialogOpened=a.payload},changeLoadingState:(e,a)=>{e.loading=a.payload},sendMessageInState:(e,a)=>{var i,t;e.userData.chats||(e.userData.chats={}),(null===(i=e.userData.chats)||void 0===i?void 0:i[a.payload.receiverId])||(e.userData.chats[a.payload.receiverId]=[]),null===(t=e.userData.chats)||void 0===t||t[a.payload.receiverId].push({message:a.payload.message,image:a.payload.image,time:a.payload.time,name:"sender",seen:!1})},receiveMessageInState:(e,a)=>{var i,t;e.userData.chats||(e.userData.chats={}),(null===(i=e.userData.chats)||void 0===i?void 0:i[a.payload.senderId])||(e.userData.chats[a.payload.senderId]=[]),null===(t=e.userData.chats)||void 0===t||t[a.payload.senderId].push({message:a.payload.message,image:a.payload.image,time:a.payload.time,name:"receiver",seen:!1})},clearMessagesInState:(e,a)=>{var i;e.userData.chats||(e.userData.chats={}),(null===(i=e.userData.chats)||void 0===i?void 0:i[a.payload])||(e.userData.chats[a.payload]=[]),e.userData.chats[a.payload]=[]},receiveNotificationInState:(e,a)=>{e.userData.notifications||(e.userData.notifications=[]),e.userData.notifications.push({name:a.payload.name,image:a.payload.image,action:a.payload.action,link:a.payload.link})},clearNotificationsInState:e=>{e.userData.notifications=[]},seenMessageInState:(e,a)=>{var i;let t=a.payload;(null===(i=e.userData.chats)||void 0===i?void 0:i[t])&&(e.userData.chats[t][e.userData.chats[t].length-1].seen=!0)},addStatusInState:(e,a)=>{if(e.userData.status){var i,t;null==e||null===(t=e.userData)||void 0===t||t.status.push({statusContent:a.payload.statusContent,colorCode:a.payload.colorCode,colorName:a.payload.colorName,_id:String((null===(i=e.userData.status)||void 0===i?void 0:i.length)+1)})}},deleteStatusInState:(e,a)=>{if(e.userData.status){let i=e.userData.status.findIndex(e=>e._id===a.payload);e.userData.status.splice(Number(i),1)}}}}),{storeUserDataInState:r,storeAllUsersDataInState:l,followUnfollowUserInState:s,handleAuthentication:o,handleDialog:n,sendMessageInState:d,receiveMessageInState:u,clearMessagesInState:c,receiveNotificationInState:m,clearNotificationsInState:p,addStatusInState:g,deleteStatusInState:h,seenMessageInState:f,changeLoadingState:y}=t.actions}},e=>{var a=a=>e(e.s=a);e.O(0,[7150,7089,7396,2282,9295,1146,3894,280,3801,1800,2976,5596,9242,8441,1517,7358],()=>a(26037)),_N_E=e.O()}]);